# 2. LANMP环境部署

Linux (Raspberry-Pi)  + Apache2 + Nginx + MySQL + PHP

## 2.1 Apache2

### 2.1.1 安装

```bash
sudo apt-get install apache2
```

## 2.1.2 端口

由于Apache2默认端口为：80

Nginx端口也是80，避开冲突，将Apache2端口更换为：8080

配置文件：`/etc/apache2/ports.conf`

将 `listen 80` 改为 `listen 8080`

```bash
sudo service apache2 start
```

### 2.1.3 测试

访问：IP:8080

## 2.2 Nginx

```bash
sudo apt-get update
sudo apt-get install nginx
sudo service nginx start
```

访问：IP

## 2.3 MySQL

### 2.3.1 安装软件包

```bash
sudo apt-get install mariadb-server-10.0
```

### 2.3.2 更改MySQL密码

```bash
mysql
```

```mysql
MariaDB [(none)]> use mysql;
MariaDB [mysql]> update user set plugin='mysql_native_password' where user='root';
MariaDB [mysql]> UPDATE user SET password=PASSWORD('你想要设定的密码') WHERE user='root';
MariaDB [mysql]> flush privileges;
MariaDB [mysql]> exit;
```

### 2.3.3 测试

```bash
sudo service mysql restart
```

## 2.4 PHP

```bash
sudo apt-get install php7.3-fpm php7.3-cli php7.3-curl php7.3-gd php7.3-cgi
sudo service php7.3-fpm start
```

### 2.4.1 配置PHP

让 Nginx 能处理 PHP

```bash
sudo vim /etc/nginx/sites-available/default
```

将其中的如下内容

```bash
location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
        }
```

替换为

```bash
location / {
index  index.html index.htm index.php default.html default.htm default.php;
}
 
location ~\.php$ {
fastcgi_pass unix:/run/php/php7.3-fpm.sock;
#fastcgi_pass 127.0.0.1:9000;
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
include fastcgi_params;
}
```

重启测试，无报错即可

```bash
sudo service nginx restart
```

