# 3.内网穿透

## 3.1 Frp

> 项目地址：https://github.com/fatedier/frp/blob/master/README_zh.md
>
> 下载地址：https://github.com/fatedier/frp/releases

### 3.1.1 文件下载

可以通过 `arch `命令查看Linux服务器架构从而下载相对应的源码包。

```bash
root@raspberrypi:/# arch
armv7l
```

下载：linux_arm_v7_client.tar.gz

### 3.1.2 文件说明

- frps.ini：服务端配置文件
- frps：服务端启动程序
- frpc.ini：客户端配置文件
- frpc：客户端启动程序

frps & frps.ini 放在 server（服务端）

frpc & frpc.ini 放在 client（客户端）

### 3.1.3 简单配置

#### 3.1.3.1 服务端

```bash
[common]						# 服务端标识头
bind_port = 7000				# 客户端与服务器端连接配对的端口

# 以下为可选
# dashboard_port = 7500			# 服务端仪表板的端口，可以访问 IP:7500访问
# token = 12345678				# 服务端仪表板的端口，请修改
# dashboard_user = admin		# 打开仪表板页面登录的用户名
# dashboard_pwd = 123123		# 打开仪表板页面登录的密码
# vhost_http_port = 10080		# 用于反向代理HTTP主机时使用
# vhost_https_port = 10443		# 用于反向代理HTTP主机时使用
# log_level = info				# 设置日志显示级别{debug, info, warn, error)
# log_max_days = 999			# 设置日志最大天数
```

#### 3.1.3.2 客户端

```bash
[common]						# 客户端标识头
server_addr = 					# 服务器公网IP 或域名
server_port = 7000				# 对应服务端的 bind_port
# token = 12345678				# 对应服务端的 token

# admin_addr = 127.0.0.1		# 管理界面127.0.0.1地址为仅限本地，0.0.0.0为不限。
# admin_port = 7400				# 管理界面端口
# admin_user = admin			# 管理界面账号
# admin_pwd = admin123			# 管理界面密码

[ssh]							# 链接ssh
type = tcp						# 穿透协议类型
local_ip = 127.0.0.1			# 本地局域网IP 或本机的127.0.0.1 IP
local_port = 22sh				# 用于监听本地设备需要穿透的端口
remote_port = 6000				# frps服务端建立穿透到内网对应应用的公网端口
```

### 3.1.4 常用命令

#### 3.1.4.1 服务端

```bash
./frps -c frps.ini				# 前台启动（关闭窗口即停止）
nohup ./frps -c frps.ini		# 后台启动（关闭窗口不停止）

# 正常启动提醒
2020/07/31 11:14:07 [I] [service.go:282] [ac4d875049a1169b] login to server success, get run id [ac4d875049a1169b], server udp port [0]
2020/07/31 11:14:07 [I] [proxy_manager.go:144] [ac4d875049a1169b] proxy added: [ssh]
2020/07/31 11:14:07 [I] [control.go:179] [ac4d875049a1169b] [ssh] start proxy success
```

#### 3.1.4.2 客户端

```bash
./frpc -c frpc.ini				# 前台启动（关闭窗口即停止）
nohup ./frpc -c frpc.ini		# 后台启动（关闭窗口不停止）

frpc.exe -c frpc.ini			# windows客户端启动
```

## 3.2 Nps

### 3.2.1 文件下载

> 项目地址：https://github.com/ehang-io/nps
>
> 下载地址：https://github.com/ehang-io/nps/releases

### 3.2.2 服务端配置

配置文件路径： `conf/nps.conf`，只需修改以下选项：

**记得在服务端里开启端口**

```bash
http_proxy_port=80
https_proxy_port=443
bridge_port=8024
web_port = 8080

# 将常用端口修改为：
http_proxy_port=63180
https_proxy_port=63443
bridge_port=8024
web_port = 8086
```

### 3.2.3 常用命令

```bash
./nps install/uninstall/start/stop/restart/status
```

### 3.2.4 web端

http://IP:8086/

在左边栏即可添加客户端，填上Basic 认证用户名，Basic 认证密码即可。

然后再选择TCP或者socsk5，按客户端添加ID号之类即可。

最后在 web 客户端的 + 号下找到链接，复制去有安装nps-client的机器下执行命令即可。

```bash
nohup ./npc -server=IP:8024 -vkey=xxxxxxx -type=tcp &
```

